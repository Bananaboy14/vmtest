<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <div id="status">Testing...</div>
    <div id="log"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            console.log(message);
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }

        function testWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host || 'localhost:8080';
            const wsUrl = `${protocol}//${host}/websockify`;
            
            log(`Attempting WebSocket connection to: ${wsUrl}`);
            
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = function(event) {
                log('WebSocket connection opened successfully!');
                statusDiv.innerHTML = '<span style="color: green;">✓ WebSocket Connected</span>';
                
                // Send some test data
                ws.send('Hello VNC Server');
            };
            
            ws.onmessage = function(event) {
                log('Received message: ' + (event.data instanceof Blob ? 'Binary data (' + event.data.size + ' bytes)' : event.data));
            };
            
            ws.onerror = function(error) {
                log('WebSocket error: ' + JSON.stringify(error));
                statusDiv.innerHTML = '<span style="color: red;">✗ WebSocket Error</span>';
            };
            
            ws.onclose = function(event) {
                log(`WebSocket closed: code=${event.code}, reason=${event.reason}, wasClean=${event.wasClean}`);
                statusDiv.innerHTML = '<span style="color: orange;">WebSocket Closed</span>';
            };
        }
        
        // Start test when page loads
        window.onload = testWebSocket;
    </script>
</body>
</html>
