<!DOCTYPE html>
<html>
<head>
    <title>Minimal VNC Test</title>
</head>
<body>
    <h1>Minimal VNC Connection Test</h1>
    <div id="screen"></div>
    <button onclick="connect()">Connect</button>
    <div id="log"></div>

    <script type="module">
        import RFB from './noVNC/core/rfb.js';

        let rfb = null;

        function log(msg) {
            document.getElementById('log').innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + msg + '</p>';
            console.log(msg);
        }

        window.connect = function() {
            log('Starting connection...');
            
            const screen = document.getElementById('screen');
            screen.innerHTML = '';
            
            // Use ws:// for local testing since GitHub Codespaces handles the protocol
            const url = 'ws://localhost:5901';
            log('Connecting to: ' + url);
            
            try {
                rfb = new RFB(screen, url, {
                    credentials: {},
                    shared: true
                });

                rfb.addEventListener('connect', function() {
                    log('✅ Connected successfully!');
                });

                rfb.addEventListener('disconnect', function(e) {
                    log('❌ Disconnected: ' + JSON.stringify(e.detail));
                });

                rfb.addEventListener('securityfailure', function(e) {
                    log('❌ Security failure: ' + JSON.stringify(e.detail));
                });

            } catch (error) {
                log('❌ Error creating RFB: ' + error.message);
            }
        };
    </script>
</body>
</html>
